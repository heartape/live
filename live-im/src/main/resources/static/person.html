<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>私聊</title>
</head>
<body>
<div id="app" style="width: 610px; height: 500px; margin: 50px auto">
    <label for="user-input"></label>
    <span>好友id</span>
    <input type="text" id="user-input" style="width: 400px; height: 50px; font-size: 20px">
    <div style="margin-top: 30px">
        <div id="message" style="overflow: scroll; overflow-x: hidden; height: 500px; width: 600px; border: 1px solid dimgray; margin-bottom: 10px"></div>
        <label for="message-input"></label>
        <input type="text" id="message-input" style="width: 500px; height: 50px; font-size: 20px">
        <button onclick="send()" style="height: 55px; width: 90px; font-size: 18px">send</button>
    </div>
</div>
</body>
<script>
    const userInput = document.getElementById(`user-input`);
    const messageInput = document.getElementById(`message-input`);
    const message = document.getElementById(`message`);
    const token = localStorage.getItem('X-Token');

    //创建一个webSocket实例，执行后，客户端就会与服务端连接
    const ws = new WebSocket("ws://localhost:8003/ws/person");

    //当WebSocket创建成功时，触发onopen事件
    ws.onopen = function(){
        console.log("open");
    }

    function send() {
        let text = messageInput.value;
        ws.send(text);
    }

    //当客户端收到服务端发来的消息时，触发onmessage事件
    ws.onmessage = function(e){
        setMessageInnerHTML(e.data)
    }

    //当客户端收到服务端发送的关闭连接请求时，触发onclose事件
    ws.onclose = function(){
        console.log("close");
    }

    //如果出现连接、处理、接收、发送数据失败的时候触发onerror事件
    ws.onerror = function(e){
        console.log(e);
    }

    function setMessageInnerHTML(innerHTML) {
        message.innerHTML += innerHTML + '<br/>';
    }
</script>
</html>